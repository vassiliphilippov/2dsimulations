<html>
<head>
  <title>Test 19: Crystal</title>
  <script src="../matter_profile.js"></script>
  <script src="../profiler.js"></script>
  <script src="../force.js"></script>
  <script src="../zonemap.js"></script>
  <script src="../background.js"></script>
  <script src="../debug.js"></script>
  <script src="../chemistryparticles.json"></script>
  <script src="../chemistrycompoundstructures.js"></script>
  <script src="../atomcolors.json"></script>
  <script src="../periodictable.json"></script>
  <script src="../chemistry.js"></script>
  <script src="../particles.js"></script>
  <script src="../temperature.js"></script>
  <script src="../chemistryrender.js"></script>
  <script src="../proximity.js"></script>
  <script src="../textureloader.js"></script>
  <script src="../scenario.js"></script>
  <script src="../animation.js"></script>
  <script src="../groups.js"></script>
  <script src="../clipper.js"></script>
  <script src="../transformation.js"></script>
  <script src="../crystal.js"></script>
  <script src="../atomdrawer.js"></script>
  <script src="../pixi.min.js"></script>
</head>
<body>
<pre id="profileoutput"></pre><p><button onclick="document.getElementById('profileoutput').innerHTML = Profiler.getStatistics(true)">Output profile informationt</button></p>
<script>

ZoneMap.load("map19.png", function (zoneMap) {
    Chemistry.spaceScale = 0.20;

    [engine, render] = Chemistry.createAndInitEngineAndRender(zoneMap, document.body, true, true);

    let bounds = ZoneMap.getBounds(zoneMap, [255, 201, 14]);
    let crystal = Crystal.create("CuSO4", bounds.min, 0);
    console.log(crystal);

    let places = Crystal.places(crystal);
    for (placeId in places) {
        let place = places[placeId];
        for (let dx=0; dx<5; dx++) {
            for (let dy=0; dy<4; dy++) {
                let index = {x: dx, y: dy};
                let position = Crystal.getPlacePosition(crystal, placeId, index);
                let particle = Chemistry.create(place.formula, position.x, position.y, place.angle);
                Crystal.stickParticleToPlace(crystal, particle, placeId, index);
                Matter.World.add(engine.world, particle);
            }
        }
    }

    Matter.Events.on(engine, "afterUpdate", (event) => {
        crystal.position.x += 1;
        Crystal.updatePlacePositions(crystal);
    });


    Chemistry.run(engine, render);
});

</script>
<p>
  Crystal;
</p>
<p><a href="map19.png">Map file</a>.</p>
</body>
</html>